# PostgreSQL Extensions Configuration
# Used by scripts/build-extensions.sh to compile and manage extensions
#
# Workflow:
# 1. CI checks if artifacts exist in GitHub Releases for current PG major version
# 2. Missing extensions are compiled using their Dockerfile
# 3. Artifacts uploaded to release "extensions-pg{major}"
# 4. Flavor images assemble pre-compiled artifacts

# PostgreSQL versions to support
pg_versions:
  - "18"
  - "17"
  - "16"
# Base image variant
base_variant: "alpine"
# GitHub release prefix for artifacts
release_prefix: "extensions-pg"
# Extensions requiring compilation
# Each extension produces: {name}-{version}-pg{major}-alpine.tar.gz
extensions:
  pgvector:
    version: "0.8.1"
    description: "Vector similarity search for AI/RAG applications"
    repo: "pgvector/pgvector"
    build_deps:
      - build-base
      - clang
      - llvm-dev
    shared_preload: false
    priority: 1 # Build order (lower = first)
  pg_partman:
    version: "5.4.0"
    description: "Partition management for time-series and large tables"
    repo: "pgpartman/pg_partman"
    build_deps:
      - build-base
    shared_preload: false
    priority: 2
  hypopg:
    version: "1.4.2"
    description: "Hypothetical indexes for query planning analysis"
    repo: "HypoPG/hypopg"
    build_deps:
      - build-base
    shared_preload: false
    priority: 2
  pg_qualstats:
    version: "2.1.3"
    description: "Statistics about predicates for index suggestions"
    repo: "powa-team/pg_qualstats"
    build_deps:
      - build-base
    shared_preload: true
    priority: 2
  paradedb:
    version: "0.20.7"
    description: "Full-text search with BM25 ranking (Elasticsearch alternative)"
    repo: "paradedb/paradedb"
    license: "AGPL-3.0"
    build_deps:
      - build-base
      - rust
      - cargo
      - clang
      - llvm-dev
      - libclang-dev
    shared_preload: false # Not required for PG17+
    priority: 3
    # NOTE: ParadeDB requires glibc (Debian) for compilation due to pgrx/bindgen
    # Alpine/musl not supported - use postgres:XX-bookworm as base
    requires_glibc: true
    disabled: true  # Temporarily disabled until Debian-based build pipeline is ready
  citus:
    version: "13.2.0"
    description: "Distributed PostgreSQL for horizontal scaling"
    repo: "citusdata/citus"
    license: "AGPL-3.0"
    build_deps:
      - build-base
      - curl-dev
      - lz4-dev
      - zstd-dev
      - icu-dev
    shared_preload: true
    priority: 3
    # Citus does not build against PG 18 yet
    # See: https://wiki.postgresql.org/wiki/PostgreSQL_18_Open_Items
    max_pg_version: 17
  timescaledb:
    version: "2.24.0"
    description: "Time-series database for high-performance analytics"
    repo: "timescale/timescaledb"
    license: "Apache-2.0 + TSL"
    build_deps:
      - build-base
      - cmake
      - openssl-dev
    shared_preload: true
    priority: 3

  # PostGIS commented out for now - very complex dependencies
  # postgis:
  #   version: "3.4.2"
  #   description: "Geospatial database extension"
  #   repo: "postgis/postgis"
  #   build_deps:
  #     - build-base
  #     - geos-dev
  #     - proj-dev
  #     - gdal-dev
  #     - json-c-dev
  #     - libxml2-dev
  #   shared_preload: false
  #   complex: true
  #   priority: 4

# Built-in extensions (no compilation needed, just CREATE EXTENSION)
builtin_extensions:
  # Statistics and monitoring
  - pg_stat_statements
  - pg_buffercache
  - pg_prewarm
  # Cryptography
  - pgcrypto
  # Data types and indexing
  - uuid-ossp
  - btree_gin
  - btree_gist
  - pg_trgm
  # Foreign data wrappers
  - file_fdw
  - postgres_fdw
  # Administration
  - adminpack
# Flavors define which compiled extensions are included per flavor
# Each flavor maps to a list of extension names from the 'extensions' section above
# The build system uses this to generate per-flavor Dockerfile FROM/COPY blocks
# Extensions are filtered at build time by max_pg_version and disabled status
#
# WARNING: This mapping must stay in sync with the install_ext case statement
# in postgres/Dockerfile. If you add/remove an extension from a flavor here,
# update the corresponding case branch in the Dockerfile as well.
flavors:
  base: []
  vector:
    - pgvector
  analytics:
    - pg_partman
    - hypopg
    - pg_qualstats
  timeseries:
    - timescaledb
    - pg_partman
  distributed:
    - citus
  full:
    - pgvector
    - pg_partman
    - hypopg
    - pg_qualstats
    - citus
    - timescaledb
