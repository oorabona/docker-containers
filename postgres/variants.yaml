# PostgreSQL Container Variants
# Defines multiple image variants per PostgreSQL major version
#
# Each version+variant produces a separate image tag:
#   ghcr.io/oorabona/postgres:18-alpine         (v18 base)
#   ghcr.io/oorabona/postgres:17-vector-alpine  (v17 vector)
#   etc.

# Build configuration
build:
  # Build arg to pass for flavor selection
  flavor_arg: FLAVOR
  # Dependencies: extension images must exist before building variants with extensions
  requires_extensions: true
  # Base image suffix (appended to version tag)
  base_suffix: "-alpine"

# Versions to build (all maintained PostgreSQL releases)
versions:
  - tag: "18"
    # PG18 - use Dockerfile.base (no extension images available yet)
    dockerfile: Dockerfile.base
    variants:
      - name: base
        suffix: ""
        flavor: base
        description: "PostgreSQL with built-in extensions only"
        default: true

  - tag: "17"
    # PG17 - full extension support
    variants:
      - name: base
        suffix: ""
        flavor: base
        description: "PostgreSQL with built-in extensions only"
        default: true
      - name: vector
        suffix: "-vector"
        flavor: vector
        description: "PostgreSQL + pgvector for AI/RAG applications"
      - name: analytics
        suffix: "-analytics"
        flavor: analytics
        description: "PostgreSQL + pg_partman, hypopg, pg_qualstats"
      - name: timeseries
        suffix: "-timeseries"
        flavor: timeseries
        description: "PostgreSQL + TimescaleDB for time-series data"
      - name: distributed
        suffix: "-distributed"
        flavor: distributed
        description: "PostgreSQL + Citus for horizontal scaling"
      # search flavor disabled - ParadeDB requires Debian/glibc for pgrx
      # - name: search
      #   suffix: "-search"
      #   flavor: search
      #   description: "PostgreSQL + ParadeDB for full-text search (BM25)"
      - name: full
        suffix: "-full"
        flavor: full
        description: "PostgreSQL with all compiled extensions"

  - tag: "16"
    # PG16 - full extension support
    variants:
      - name: base
        suffix: ""
        flavor: base
        description: "PostgreSQL with built-in extensions only"
        default: true
      - name: vector
        suffix: "-vector"
        flavor: vector
        description: "PostgreSQL + pgvector for AI/RAG applications"
      - name: analytics
        suffix: "-analytics"
        flavor: analytics
        description: "PostgreSQL + pg_partman, hypopg, pg_qualstats"
      - name: timeseries
        suffix: "-timeseries"
        flavor: timeseries
        description: "PostgreSQL + TimescaleDB for time-series data"
      - name: distributed
        suffix: "-distributed"
        flavor: distributed
        description: "PostgreSQL + Citus for horizontal scaling"
      # search flavor disabled - ParadeDB requires Debian/glibc for pgrx
      # - name: search
      #   suffix: "-search"
      #   flavor: search
      #   description: "PostgreSQL + ParadeDB for full-text search (BM25)"
      - name: full
        suffix: "-full"
        flavor: full
        description: "PostgreSQL with all compiled extensions"
