# PostgreSQL Container Variants
# Defines multiple image variants per PostgreSQL major version
#
# Each version+variant produces a separate image tag:
#   ghcr.io/oorabona/postgres:18-alpine         (v18 base)
#   ghcr.io/oorabona/postgres:17-vector-alpine  (v17 vector)
#   etc.

# Build configuration
build:
  # Build arg to pass for flavor selection
  flavor_arg: FLAVOR
  # Dependencies: extension images must exist before building variants with extensions
  requires_extensions: true
  # Base image suffix (appended to version tag)
  base_suffix: "-alpine"

# Versions to build (all maintained PostgreSQL releases)
versions:
  - tag: "18"
    # PG18 - full extension support (Citus 14.0.0 adds PG 18 compatibility)
    variants:
      - name: base
        suffix: ""
        flavor: base
        description: "PostgreSQL with built-in extensions only"
        default: true
      - name: vector
        suffix: "-vector"
        flavor: vector
        description: "PostgreSQL + pgvector, pg_search, pg_cron, pg_ivm"
      - name: analytics
        suffix: "-analytics"
        flavor: analytics
        description: "PostgreSQL + pg_partman, hypopg, pg_qualstats, postgis, pg_cron, pg_ivm"
      - name: timeseries
        suffix: "-timeseries"
        flavor: timeseries
        description: "PostgreSQL + TimescaleDB, pg_partman, postgis, pg_cron, pg_ivm"
      - name: spatial
        suffix: "-spatial"
        flavor: spatial
        description: "PostgreSQL + PostGIS for geospatial workloads"
      - name: distributed
        suffix: "-distributed"
        flavor: distributed
        description: "PostgreSQL + Citus, pg_cron, pg_ivm for horizontal scaling"
      - name: full
        suffix: "-full"
        flavor: full
        description: "PostgreSQL with all compiled extensions"

  - tag: "17"
    # PG17 - full extension support
    variants:
      - name: base
        suffix: ""
        flavor: base
        description: "PostgreSQL with built-in extensions only"
        default: true
      - name: vector
        suffix: "-vector"
        flavor: vector
        description: "PostgreSQL + pgvector, pg_search, pg_cron, pg_ivm"
      - name: analytics
        suffix: "-analytics"
        flavor: analytics
        description: "PostgreSQL + pg_partman, hypopg, pg_qualstats, postgis, pg_cron, pg_ivm"
      - name: timeseries
        suffix: "-timeseries"
        flavor: timeseries
        description: "PostgreSQL + TimescaleDB, pg_partman, postgis, pg_cron, pg_ivm"
      - name: spatial
        suffix: "-spatial"
        flavor: spatial
        description: "PostgreSQL + PostGIS for geospatial workloads"
      - name: distributed
        suffix: "-distributed"
        flavor: distributed
        description: "PostgreSQL + Citus, pg_cron, pg_ivm for horizontal scaling"
      - name: full
        suffix: "-full"
        flavor: full
        description: "PostgreSQL with all compiled extensions"

  - tag: "16"
    # PG16 - full extension support
    variants:
      - name: base
        suffix: ""
        flavor: base
        description: "PostgreSQL with built-in extensions only"
        default: true
      - name: vector
        suffix: "-vector"
        flavor: vector
        description: "PostgreSQL + pgvector, pg_search, pg_cron, pg_ivm"
      - name: analytics
        suffix: "-analytics"
        flavor: analytics
        description: "PostgreSQL + pg_partman, hypopg, pg_qualstats, postgis, pg_cron, pg_ivm"
      - name: timeseries
        suffix: "-timeseries"
        flavor: timeseries
        description: "PostgreSQL + TimescaleDB, pg_partman, postgis, pg_cron, pg_ivm"
      - name: spatial
        suffix: "-spatial"
        flavor: spatial
        description: "PostgreSQL + PostGIS for geospatial workloads"
      - name: distributed
        suffix: "-distributed"
        flavor: distributed
        description: "PostgreSQL + Citus, pg_cron, pg_ivm for horizontal scaling"
      - name: full
        suffix: "-full"
        flavor: full
        description: "PostgreSQL with all compiled extensions"
