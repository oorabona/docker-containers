---
layout: dashboard
title: Container Details
permalink: /container
---

<div id="container-detail" class="container-detail-page">
  <div class="detail-loading glass">
    <i class="ti ti-loader-2 spin"></i>
    <p>Loading container details...</p>
  </div>
</div>

<style>
  .container-detail-page {
    min-height: 400px;
  }

  .detail-loading {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 4rem;
    text-align: center;
    color: var(--text-muted);
  }

  .detail-loading i {
    font-size: 2.5rem;
    margin-bottom: 1rem;
  }

  .spin {
    animation: spin 1s linear infinite;
  }

  @keyframes spin {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
  }

  .detail-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 2rem;
    flex-wrap: wrap;
    gap: 1rem;
  }

  .detail-title {
    display: flex;
    align-items: center;
    gap: 1rem;
  }

  .detail-title h1 {
    font-size: 2rem;
    font-weight: 700;
    margin: 0;
  }

  .detail-badge {
    font-family: 'SF Mono', 'Fira Code', monospace;
    font-size: 0.875rem;
    padding: 0.375rem 0.875rem;
    border-radius: 8px;
    background: rgba(16, 185, 129, 0.2);
    color: #34d399;
    border: 1px solid rgba(16, 185, 129, 0.3);
  }

  .detail-actions {
    display: flex;
    gap: 0.75rem;
  }

  .detail-meta {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1rem;
    margin-bottom: 2rem;
  }

  .meta-card {
    padding: 1.25rem;
  }

  .meta-card-label {
    font-size: 0.75rem;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: var(--text-muted);
    margin-bottom: 0.5rem;
  }

  .meta-card-value {
    font-size: 1.125rem;
    font-weight: 600;
  }

  .readme-section {
    padding: 2rem;
  }

  .readme-header {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    margin-bottom: 1.5rem;
    padding-bottom: 1rem;
    border-bottom: 1px solid var(--glass-border);
  }

  .readme-header h2 {
    margin: 0;
    font-size: 1.25rem;
  }

  .readme-content {
    color: var(--text-secondary);
    line-height: 1.7;
  }

  .readme-content h1,
  .readme-content h2,
  .readme-content h3,
  .readme-content h4 {
    color: var(--text-primary);
    margin-top: 1.5em;
    margin-bottom: 0.75em;
  }

  .readme-content h1 { font-size: 1.75rem; }
  .readme-content h2 { font-size: 1.5rem; }
  .readme-content h3 { font-size: 1.25rem; }
  .readme-content h4 { font-size: 1.125rem; }

  .readme-content p {
    margin-bottom: 1em;
  }

  .readme-content code {
    font-family: 'SF Mono', 'Fira Code', monospace;
    font-size: 0.875em;
    padding: 0.2em 0.4em;
    background: rgba(0, 0, 0, 0.3);
    border-radius: 4px;
    color: #f472b6;
  }

  .readme-content pre {
    background: rgba(0, 0, 0, 0.3);
    border-radius: 8px;
    padding: 1rem;
    overflow-x: auto;
    margin: 1em 0;
  }

  .readme-content pre code {
    background: none;
    padding: 0;
    color: var(--text-secondary);
  }

  .readme-content ul,
  .readme-content ol {
    margin: 1em 0;
    padding-left: 1.5em;
  }

  .readme-content li {
    margin-bottom: 0.5em;
  }

  .readme-content a {
    color: var(--accent-blue);
    text-decoration: none;
  }

  .readme-content a:hover {
    text-decoration: underline;
  }

  .readme-content blockquote {
    border-left: 3px solid var(--accent-purple);
    margin: 1em 0;
    padding-left: 1em;
    color: var(--text-muted);
    font-style: italic;
  }

  .readme-content table {
    width: 100%;
    border-collapse: collapse;
    margin: 1em 0;
  }

  .readme-content th,
  .readme-content td {
    padding: 0.75rem;
    border: 1px solid var(--glass-border);
    text-align: left;
  }

  .readme-content th {
    background: rgba(255, 255, 255, 0.05);
    font-weight: 600;
  }

  .readme-content img {
    max-width: 100%;
    border-radius: 8px;
  }

  .readme-error {
    text-align: center;
    padding: 2rem;
    color: var(--text-muted);
  }

  .readme-error i {
    font-size: 3rem;
    margin-bottom: 1rem;
    display: block;
    color: var(--accent-yellow);
  }

  /* Variants section styles */
  .variants-section {
    padding: 1.5rem;
    margin-bottom: 2rem;
  }

  .variants-header {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    margin-bottom: 1.5rem;
    padding-bottom: 1rem;
    border-bottom: 1px solid var(--glass-border);
  }

  .variants-header h2 {
    margin: 0;
    font-size: 1.25rem;
  }

  .variants-content {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
  }

  .version-group {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
  }

  .version-title {
    font-size: 1rem;
    font-weight: 600;
    margin: 0;
    color: var(--text-secondary);
  }

  .variant-tags-row {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
  }

  .variant-tag {
    font-family: 'SF Mono', 'Fira Code', monospace;
    font-size: 0.75rem;
    padding: 0.375rem 0.75rem;
    border-radius: 6px;
    background: rgba(139, 92, 246, 0.15);
    color: var(--accent-purple);
    border: 1px solid rgba(139, 92, 246, 0.25);
    cursor: pointer;
    transition: all 0.2s ease;
  }

  .variant-tag:hover {
    background: rgba(139, 92, 246, 0.25);
    transform: translateY(-1px);
  }

  .variant-tag.selected {
    background: rgba(139, 92, 246, 0.3);
    border-color: var(--accent-purple);
    box-shadow: 0 0 0 2px rgba(139, 92, 246, 0.2);
  }

  .back-link {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    margin-bottom: 1.5rem;
    color: var(--text-secondary);
    text-decoration: none;
    font-size: 0.875rem;
    transition: color 0.2s ease;
  }

  .back-link:hover {
    color: var(--text-primary);
  }

  /* Table responsive wrapper */
  .table-wrapper {
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
    margin: 1em 0;
  }

  .table-wrapper table {
    margin: 0;
  }

  /* Focus visible styles for accessibility */
  .variant-tag:focus-visible,
  .back-link:focus-visible,
  .btn:focus-visible {
    outline: 2px solid var(--accent-blue);
    outline-offset: 2px;
  }

  /* Responsive styles */
  @media (max-width: 1024px) {
    .detail-meta {
      grid-template-columns: repeat(2, 1fr);
    }
  }

  @media (max-width: 768px) {
    .detail-header {
      flex-direction: column;
      align-items: flex-start;
    }

    .detail-title h1 {
      font-size: 1.5rem;
    }

    .detail-actions {
      width: 100%;
      flex-wrap: wrap;
    }

    .detail-actions .btn {
      flex: 1;
      min-width: 120px;
      justify-content: center;
    }

    .detail-meta {
      grid-template-columns: 1fr;
    }

    .readme-section {
      padding: 1rem;
    }

    .readme-content h1 { font-size: 1.5rem; }
    .readme-content h2 { font-size: 1.25rem; }
    .readme-content h3 { font-size: 1.125rem; }

    .readme-content pre {
      padding: 0.75rem;
      font-size: 0.8rem;
    }

    .variants-section {
      padding: 1rem;
    }

    .variant-tags-row {
      gap: 0.375rem;
    }

    .variant-tag {
      font-size: 0.7rem;
      padding: 0.25rem 0.5rem;
    }
  }

  @media (max-width: 480px) {
    .detail-title h1 {
      font-size: 1.25rem;
    }

    .detail-badge {
      font-size: 0.75rem;
      padding: 0.25rem 0.5rem;
    }

    .meta-card {
      padding: 1rem;
    }

    .meta-card-value {
      font-size: 1rem;
      word-break: break-all;
    }
  }

  /* Respect reduced motion preference (WCAG 2.1 2.3.3) */
  @media (prefers-reduced-motion: reduce) {
    *,
    *::before,
    *::after {
      animation-duration: 0.01ms !important;
      animation-iteration-count: 1 !important;
      transition-duration: 0.01ms !important;
      scroll-behavior: auto !important;
    }
  }
</style>

<!-- marked.js for markdown rendering + DOMPurify for XSS protection -->
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/dompurify@3.0.6/dist/purify.min.js"></script>

<script>
  // Store baseurl from Jekyll for JavaScript use
  const siteBaseurl = '{{ site.baseurl }}';

  // Safe HTML rendering function using DOMPurify
  function safeSetHTML(element, html) {
    if (typeof DOMPurify === 'undefined') {
      console.error('DOMPurify not loaded');
      element.innerHTML = html; // Fallback (less secure)
      return;
    }
    const sanitized = DOMPurify.sanitize(html, {
      ALLOWED_TAGS: ['h1', 'h2', 'h3', 'h4', 'h5', 'h6', 'p', 'a', 'ul', 'ol', 'li',
                     'code', 'pre', 'blockquote', 'table', 'thead', 'tbody', 'tr', 'th', 'td',
                     'strong', 'em', 'br', 'hr', 'img', 'span', 'div', 'i'],
      ALLOWED_ATTR: ['id', 'href', 'src', 'alt', 'title', 'class', 'target', 'rel']
    });
    element.innerHTML = sanitized;
  }

  // Build variants section HTML
  function buildVariantsHTML(containerData) {
    if (!containerData.has_variants || !containerData.versions) {
      return '';
    }

    let html = `
      <div class="variants-section glass">
        <div class="variants-header">
          <i class="ti ti-git-branch"></i>
          <h2>Available Variants</h2>
        </div>
        <div class="variants-content">
    `;

    containerData.versions.forEach((version, versionIdx) => {
      html += `
        <div class="version-group">
          <h3 class="version-title">PostgreSQL ${DOMPurify.sanitize(version.tag)}</h3>
          <div class="variant-tags-row">
      `;

      version.variants.forEach((variant, variantIdx) => {
        const isSelected = versionIdx === 0 && variantIdx === 0;
        html += `
          <span class="variant-tag${isSelected ? ' selected' : ''}"
                data-tag="${DOMPurify.sanitize(variant.tag)}"
                data-size-amd64="${DOMPurify.sanitize(variant.size_amd64 || '')}"
                data-size-arm64="${DOMPurify.sanitize(variant.size_arm64 || '')}"
                onclick="selectDetailVariant(this)"
                onkeydown="if(event.key==='Enter'||event.key===' '){event.preventDefault();selectDetailVariant(this);}"
                role="button"
                tabindex="0"
                aria-pressed="${isSelected}"
                title="${DOMPurify.sanitize(variant.description || '')}">
            ${DOMPurify.sanitize(variant.name)}${variant.is_default ? ' (default)' : ''}
          </span>
        `;
      });

      html += `
          </div>
        </div>
      `;
    });

    html += `
        </div>
      </div>
    `;

    return html;
  }

  // Build static HTML content safely
  function buildContainerHTML(containerData, containerName) {
    const container = document.createElement('div');

    // Back link - use baseurl
    const backLink = document.createElement('a');
    backLink.href = siteBaseurl + '/';
    backLink.className = 'back-link';
    backLink.innerHTML = '<i class="ti ti-arrow-left"></i> Back to Dashboard';
    container.appendChild(backLink);

    // Header
    const header = document.createElement('div');
    header.className = 'detail-header';
    header.innerHTML = `
      <div class="detail-title">
        <h1>${DOMPurify.sanitize(containerData.name)}</h1>
        <span class="detail-badge">${DOMPurify.sanitize(containerData.current_version)}</span>
      </div>
      <div class="detail-actions">
        <a href="https://github.com/oorabona/docker-containers/tree/master/${encodeURIComponent(containerName)}"
           class="btn" target="_blank" rel="noopener"
           aria-label="View source code on GitHub">
          <i class="ti ti-brand-github" aria-hidden="true"></i> Source
        </a>
        <a href="https://ghcr.io/oorabona/${encodeURIComponent(containerName)}"
           class="btn" target="_blank" rel="noopener"
           aria-label="View package on GitHub Container Registry">
          <i class="ti ti-package" aria-hidden="true"></i> GHCR
        </a>
      </div>
    `;
    container.appendChild(header);

    // Meta cards with data attributes for dynamic updates
    const meta = document.createElement('div');
    meta.className = 'detail-meta';
    meta.id = 'detail-meta';
    meta.innerHTML = `
      <div class="meta-card glass">
        <div class="meta-card-label">Status</div>
        <div class="meta-card-value">${DOMPurify.sanitize(containerData.status_text)}</div>
      </div>
      <div class="meta-card glass">
        <div class="meta-card-label">Current Tag</div>
        <div class="meta-card-value" data-meta="current-tag">${DOMPurify.sanitize(containerData.current_version)}</div>
      </div>
      <div class="meta-card glass">
        <div class="meta-card-label">Docker Hub Pulls</div>
        <div class="meta-card-value">${DOMPurify.sanitize(containerData.pull_count_formatted || '0')}</div>
      </div>
      <div class="meta-card glass">
        <div class="meta-card-label">Stars</div>
        <div class="meta-card-value">
          <i class="ti ti-star" style="font-size: 0.75rem; color: var(--accent-yellow);"></i>
          ${DOMPurify.sanitize(String(containerData.star_count || 0))}
        </div>
      </div>
      <div class="meta-card glass">
        <div class="meta-card-label">Size (amd64)</div>
        <div class="meta-card-value" data-meta="size-amd64">${DOMPurify.sanitize(containerData.size_amd64 || '—')}</div>
      </div>
      <div class="meta-card glass">
        <div class="meta-card-label">Size (arm64)</div>
        <div class="meta-card-value" data-meta="size-arm64">${DOMPurify.sanitize(containerData.size_arm64 || '—')}</div>
      </div>
    `;
    container.appendChild(meta);

    // Variants section (if container has variants)
    const variantsHTML = buildVariantsHTML(containerData);
    if (variantsHTML) {
      const variantsDiv = document.createElement('div');
      variantsDiv.innerHTML = variantsHTML;
      container.appendChild(variantsDiv.firstElementChild);
    }

    // README section
    const readmeSection = document.createElement('div');
    readmeSection.className = 'readme-section glass';
    readmeSection.innerHTML = `
      <div class="readme-header">
        <i class="ti ti-file-text"></i>
        <h2>Documentation</h2>
      </div>
      <div class="readme-content" id="readme-content">
        <div class="detail-loading" style="padding: 2rem;">
          <i class="ti ti-loader-2 spin"></i>
          <p>Loading README...</p>
        </div>
      </div>
    `;
    container.appendChild(readmeSection);

    return container.innerHTML;
  }

  // Build error HTML
  function buildErrorHTML(message, iconClass) {
    const baseurl = siteBaseurl || '';
    return `
      <a href="${baseurl}/" class="back-link"><i class="ti ti-arrow-left"></i> Back to Dashboard</a>
      <div class="readme-error">
        <i class="ti ${iconClass}"></i>
        <p>${typeof DOMPurify !== 'undefined' ? DOMPurify.sanitize(message) : message}</p>
        <a href="${baseurl}/" class="btn btn-primary" style="margin-top: 1rem;">
          <i class="ti ti-home"></i> Go to Dashboard
        </a>
      </div>
    `;
  }

  // Handle variant selection in details page
  function selectDetailVariant(element) {
    // Update selected state and ARIA
    const container = element.closest('.variants-section');
    if (container) {
      container.querySelectorAll('.variant-tag').forEach(t => {
        t.classList.remove('selected');
        t.setAttribute('aria-pressed', 'false');
      });
    }
    element.classList.add('selected');
    element.setAttribute('aria-pressed', 'true');

    // Update metadata from data attributes
    const tag = element.dataset.tag || '—';
    const sizeAmd64 = element.dataset.sizeAmd64 || '—';
    const sizeArm64 = element.dataset.sizeArm64 || '—';

    const tagEl = document.querySelector('[data-meta="current-tag"]');
    const sizeAmd64El = document.querySelector('[data-meta="size-amd64"]');
    const sizeArm64El = document.querySelector('[data-meta="size-arm64"]');

    if (tagEl) tagEl.textContent = tag;
    if (sizeAmd64El) sizeAmd64El.textContent = sizeAmd64 || '—';
    if (sizeArm64El) sizeArm64El.textContent = sizeArm64 || '—';
  }

  document.addEventListener('DOMContentLoaded', async function() {
    const container = document.getElementById('container-detail');
    const params = new URLSearchParams(window.location.search);
    const containerName = params.get('name');

    if (!containerName) {
      safeSetHTML(container, buildErrorHTML(
        'No container specified. Please select a container from the dashboard.',
        'ti-alert-triangle'
      ));
      return;
    }

    // Validate container name (alphanumeric, dash, underscore only)
    if (!/^[a-zA-Z0-9_-]+$/.test(containerName)) {
      safeSetHTML(container, buildErrorHTML(
        'Invalid container name.',
        'ti-alert-triangle'
      ));
      return;
    }

    // Find container data from Jekyll
    const containers = {{ site.data.containers | jsonify }};
    const containerData = containers.find(c => c.name === containerName);

    if (!containerData) {
      safeSetHTML(container, buildErrorHTML(
        `Container "${containerName}" not found.`,
        'ti-package-off'
      ));
      return;
    }

    // Update page title
    document.title = `${containerData.name} | Container Details`;

    // Render container info
    safeSetHTML(container, buildContainerHTML(containerData, containerName));

    // Fetch and render README
    const readmeContainer = document.getElementById('readme-content');

    // Check if marked.js is loaded
    if (typeof marked === 'undefined') {
      console.error('marked.js not loaded');
      safeSetHTML(readmeContainer, `
        <div class="readme-error">
          <i class="ti ti-alert-triangle"></i>
          <p>Markdown renderer not available. Please refresh the page.</p>
        </div>
      `);
      return;
    }

    try {
      const readmeUrl = `https://raw.githubusercontent.com/oorabona/docker-containers/master/${encodeURIComponent(containerName)}/README.md`;
      console.log('Fetching README from:', readmeUrl);

      const response = await fetch(readmeUrl);

      if (!response.ok) {
        console.error('README fetch failed:', response.status, response.statusText);
        throw new Error(`README not found (HTTP ${response.status})`);
      }

      const markdown = await response.text();
      console.log('README loaded, length:', markdown.length);

      const html = marked.parse(markdown);
      safeSetHTML(readmeContainer, html);

      // Wrap tables in responsive container for mobile
      readmeContainer.querySelectorAll('table').forEach(table => {
        if (!table.parentElement.classList.contains('table-wrapper')) {
          const wrapper = document.createElement('div');
          wrapper.className = 'table-wrapper';
          wrapper.setAttribute('role', 'region');
          wrapper.setAttribute('aria-label', 'Scrollable table');
          wrapper.setAttribute('tabindex', '0');
          table.parentNode.insertBefore(wrapper, table);
          wrapper.appendChild(table);
        }
      });
    } catch (error) {
      console.error('README loading error:', error);
      safeSetHTML(readmeContainer, `
        <div class="readme-error">
          <i class="ti ti-file-off"></i>
          <p>Could not load README for this container.</p>
          <p style="font-size: 0.8rem; color: var(--text-muted); margin-top: 0.5rem;">
            ${error.message || 'Network error'}
          </p>
        </div>
      `);
    }
  });
</script>
