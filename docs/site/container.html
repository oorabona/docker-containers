---
layout: dashboard
title: Container Details
permalink: /container
---

<div id="container-detail" class="container-detail-page">
  <div class="detail-loading glass">
    <i class="ti ti-loader-2 spin"></i>
    <p>Loading container details...</p>
  </div>
</div>

<style>
  .container-detail-page {
    min-height: 400px;
  }

  .detail-loading {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 4rem;
    text-align: center;
    color: var(--text-muted);
  }

  .detail-loading i {
    font-size: 2.5rem;
    margin-bottom: 1rem;
  }

  .spin {
    animation: spin 1s linear infinite;
  }

  @keyframes spin {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
  }

  .detail-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 2rem;
    flex-wrap: wrap;
    gap: 1rem;
  }

  .detail-title {
    display: flex;
    align-items: center;
    gap: 1rem;
  }

  .detail-title h1 {
    font-size: 2rem;
    font-weight: 700;
    margin: 0;
  }

  .detail-badge {
    font-family: 'SF Mono', 'Fira Code', monospace;
    font-size: 0.875rem;
    padding: 0.375rem 0.875rem;
    border-radius: 8px;
    background: rgba(16, 185, 129, 0.2);
    color: #34d399;
    border: 1px solid rgba(16, 185, 129, 0.3);
  }

  .detail-actions {
    display: flex;
    gap: 0.75rem;
  }

  .detail-meta {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1rem;
    margin-bottom: 2rem;
  }

  .meta-card {
    padding: 1.25rem;
  }

  .meta-card-label {
    font-size: 0.75rem;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: var(--text-muted);
    margin-bottom: 0.5rem;
  }

  .meta-card-value {
    font-size: 1.125rem;
    font-weight: 600;
  }

  .readme-section {
    padding: 2rem;
  }

  .readme-header {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    margin-bottom: 1.5rem;
    padding-bottom: 1rem;
    border-bottom: 1px solid var(--glass-border);
  }

  .readme-header h2 {
    margin: 0;
    font-size: 1.25rem;
  }

  .readme-content {
    color: var(--text-secondary);
    line-height: 1.7;
  }

  .readme-content h1,
  .readme-content h2,
  .readme-content h3,
  .readme-content h4 {
    color: var(--text-primary);
    margin-top: 1.5em;
    margin-bottom: 0.75em;
  }

  .readme-content h1 { font-size: 1.75rem; }
  .readme-content h2 { font-size: 1.5rem; }
  .readme-content h3 { font-size: 1.25rem; }
  .readme-content h4 { font-size: 1.125rem; }

  .readme-content p {
    margin-bottom: 1em;
  }

  .readme-content code {
    font-family: 'SF Mono', 'Fira Code', monospace;
    font-size: 0.875em;
    padding: 0.2em 0.4em;
    background: rgba(0, 0, 0, 0.3);
    border-radius: 4px;
    color: #f472b6;
  }

  .readme-content pre {
    background: rgba(0, 0, 0, 0.3);
    border-radius: 8px;
    padding: 1rem;
    overflow-x: auto;
    margin: 1em 0;
  }

  .readme-content pre code {
    background: none;
    padding: 0;
    color: var(--text-secondary);
  }

  .readme-content ul,
  .readme-content ol {
    margin: 1em 0;
    padding-left: 1.5em;
  }

  .readme-content li {
    margin-bottom: 0.5em;
  }

  .readme-content a {
    color: var(--accent-blue);
    text-decoration: none;
  }

  .readme-content a:hover {
    text-decoration: underline;
  }

  .readme-content blockquote {
    border-left: 3px solid var(--accent-purple);
    margin: 1em 0;
    padding-left: 1em;
    color: var(--text-muted);
    font-style: italic;
  }

  .readme-content table {
    width: 100%;
    border-collapse: collapse;
    margin: 1em 0;
  }

  .readme-content th,
  .readme-content td {
    padding: 0.75rem;
    border: 1px solid var(--glass-border);
    text-align: left;
  }

  .readme-content th {
    background: rgba(255, 255, 255, 0.05);
    font-weight: 600;
  }

  .readme-content img {
    max-width: 100%;
    border-radius: 8px;
  }

  .readme-error {
    text-align: center;
    padding: 2rem;
    color: var(--text-muted);
  }

  .readme-error i {
    font-size: 3rem;
    margin-bottom: 1rem;
    display: block;
    color: var(--accent-yellow);
  }

  .back-link {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    margin-bottom: 1.5rem;
    color: var(--text-secondary);
    text-decoration: none;
    font-size: 0.875rem;
    transition: color 0.2s ease;
  }

  .back-link:hover {
    color: var(--text-primary);
  }
</style>

<!-- marked.js for markdown rendering + DOMPurify for XSS protection -->
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/dompurify@3.0.6/dist/purify.min.js"></script>

<script>
  // Safe HTML rendering function using DOMPurify
  function safeSetHTML(element, html) {
    const sanitized = DOMPurify.sanitize(html, {
      ALLOWED_TAGS: ['h1', 'h2', 'h3', 'h4', 'h5', 'h6', 'p', 'a', 'ul', 'ol', 'li',
                     'code', 'pre', 'blockquote', 'table', 'thead', 'tbody', 'tr', 'th', 'td',
                     'strong', 'em', 'br', 'hr', 'img', 'span', 'div'],
      ALLOWED_ATTR: ['href', 'src', 'alt', 'title', 'class', 'target', 'rel']
    });
    element.innerHTML = sanitized;
  }

  // Build static HTML content safely
  function buildContainerHTML(containerData, containerName) {
    const container = document.createElement('div');

    // Back link
    const backLink = document.createElement('a');
    backLink.href = '/';
    backLink.className = 'back-link';
    backLink.innerHTML = '<i class="ti ti-arrow-left"></i> Back to Dashboard';
    container.appendChild(backLink);

    // Header
    const header = document.createElement('div');
    header.className = 'detail-header';
    header.innerHTML = `
      <div class="detail-title">
        <h1>${DOMPurify.sanitize(containerData.name)}</h1>
        <span class="detail-badge">${DOMPurify.sanitize(containerData.current_version)}</span>
      </div>
      <div class="detail-actions">
        <a href="https://github.com/oorabona/docker-containers/tree/master/${encodeURIComponent(containerName)}"
           class="btn" target="_blank" rel="noopener">
          <i class="ti ti-brand-github"></i> Source
        </a>
        <a href="https://ghcr.io/oorabona/${encodeURIComponent(containerName)}"
           class="btn" target="_blank" rel="noopener">
          <i class="ti ti-package"></i> GHCR
        </a>
      </div>
    `;
    container.appendChild(header);

    // Meta cards
    const meta = document.createElement('div');
    meta.className = 'detail-meta';
    meta.innerHTML = `
      <div class="meta-card glass">
        <div class="meta-card-label">Status</div>
        <div class="meta-card-value">${DOMPurify.sanitize(containerData.status_text)}</div>
      </div>
      <div class="meta-card glass">
        <div class="meta-card-label">Latest Version</div>
        <div class="meta-card-value">${DOMPurify.sanitize(containerData.latest_version)}</div>
      </div>
      <div class="meta-card glass">
        <div class="meta-card-label">Docker Hub Pulls</div>
        <div class="meta-card-value">${DOMPurify.sanitize(containerData.pull_count_formatted || '0')}</div>
      </div>
      <div class="meta-card glass">
        <div class="meta-card-label">Size (amd64)</div>
        <div class="meta-card-value">${DOMPurify.sanitize(containerData.size_amd64 || 'â€”')}</div>
      </div>
    `;
    container.appendChild(meta);

    // README section
    const readmeSection = document.createElement('div');
    readmeSection.className = 'readme-section glass';
    readmeSection.innerHTML = `
      <div class="readme-header">
        <i class="ti ti-file-text"></i>
        <h2>Documentation</h2>
      </div>
      <div class="readme-content" id="readme-content">
        <div class="detail-loading" style="padding: 2rem;">
          <i class="ti ti-loader-2 spin"></i>
          <p>Loading README...</p>
        </div>
      </div>
    `;
    container.appendChild(readmeSection);

    return container.innerHTML;
  }

  // Build error HTML
  function buildErrorHTML(message, iconClass) {
    return `
      <a href="/" class="back-link"><i class="ti ti-arrow-left"></i> Back to Dashboard</a>
      <div class="readme-error">
        <i class="ti ${iconClass}"></i>
        <p>${DOMPurify.sanitize(message)}</p>
        <a href="/" class="btn btn-primary" style="margin-top: 1rem;">
          <i class="ti ti-home"></i> Go to Dashboard
        </a>
      </div>
    `;
  }

  document.addEventListener('DOMContentLoaded', async function() {
    const container = document.getElementById('container-detail');
    const params = new URLSearchParams(window.location.search);
    const containerName = params.get('name');

    if (!containerName) {
      safeSetHTML(container, buildErrorHTML(
        'No container specified. Please select a container from the dashboard.',
        'ti-alert-triangle'
      ));
      return;
    }

    // Validate container name (alphanumeric, dash, underscore only)
    if (!/^[a-zA-Z0-9_-]+$/.test(containerName)) {
      safeSetHTML(container, buildErrorHTML(
        'Invalid container name.',
        'ti-alert-triangle'
      ));
      return;
    }

    // Find container data from Jekyll
    const containers = {{ site.data.containers | jsonify }};
    const containerData = containers.find(c => c.name === containerName);

    if (!containerData) {
      safeSetHTML(container, buildErrorHTML(
        `Container "${DOMPurify.sanitize(containerName)}" not found.`,
        'ti-package-off'
      ));
      return;
    }

    // Update page title
    document.title = `${containerData.name} | Container Details`;

    // Render container info
    safeSetHTML(container, buildContainerHTML(containerData, containerName));

    // Fetch and render README
    const readmeContainer = document.getElementById('readme-content');
    try {
      const response = await fetch(
        `https://raw.githubusercontent.com/oorabona/docker-containers/master/${encodeURIComponent(containerName)}/README.md`
      );

      if (!response.ok) {
        throw new Error('README not found');
      }

      const markdown = await response.text();
      const html = marked.parse(markdown);
      safeSetHTML(readmeContainer, html);
    } catch (error) {
      safeSetHTML(readmeContainer, `
        <div class="readme-error">
          <i class="ti ti-file-off"></i>
          <p>Could not load README for this container.</p>
        </div>
      `);
    }
  });
</script>
