<!-- Enhanced Container Status Card - Glassmorphism Style -->
<article class="container-card glass status-{{ include.status_color | default: 'secondary' }}"
     data-container="{{ include.name }}"
     data-github-username="{{ include.github_username }}"
     data-dockerhub-username="{{ include.dockerhub_username }}"
     aria-label="{{ include.name }} container - {{ include.status_text | default: 'Unknown status' }}">
  <div class="card-header-row">
    <div class="card-name">{{ include.name }}</div>
    <span class="card-badge{% if include.status_color == 'warning' %} warning{% endif %}">
      {{ include.current_version | default: 'unknown' }}
    </span>
  </div>

  <div class="card-status">
    {% if include.build_status == 'success' %}
      <i class="ti ti-circle-check" style="color: var(--accent-green);" aria-hidden="true"></i>
    {% elsif include.build_status == 'failed' %}
      <i class="ti ti-circle-x" style="color: var(--accent-pink);" aria-hidden="true"></i>
    {% else %}
      <i class="ti ti-loader" style="color: var(--accent-yellow);" aria-hidden="true"></i>
    {% endif %}
    {{ include.status_text | default: 'Unknown' }}
  </div>

  {% if include.latest_version %}
  <div class="card-meta">
    <div class="card-meta-item">
      <span class="card-meta-label">Latest</span>
      <span class="card-meta-value">{{ include.latest_version }}</span>
    </div>
    <div class="card-meta-item">
      <span class="card-meta-label">Pulls</span>
      <span class="card-meta-value">
        <i class="ti ti-download" style="font-size: 0.75rem;" aria-hidden="true"></i>
        {{ include.pull_count_formatted | default: "0" }}
      </span>
    </div>
    <div class="card-meta-item">
      <span class="card-meta-label">Stars</span>
      <span class="card-meta-value">
        <i class="ti ti-star" style="font-size: 0.75rem; color: var(--accent-yellow);" aria-hidden="true"></i>
        {{ include.star_count | default: 0 }}
      </span>
    </div>
    {% if include.size_amd64 or include.size_arm64 or include.has_variants %}
    <div class="card-meta-item">
      <span class="card-meta-label">Size (amd64)</span>
      <span class="card-meta-value" data-meta="size-amd64">{{ include.size_amd64 | default: "—" }}</span>
    </div>
    <div class="card-meta-item">
      <span class="card-meta-label">Size (arm64)</span>
      <span class="card-meta-value" data-meta="size-arm64">{{ include.size_arm64 | default: "—" }}</span>
    </div>
    {% endif %}
    {% if include.build_digest and include.build_digest != "unknown" and include.build_digest != "per-variant" %}
    <div class="card-meta-item">
      <span class="card-meta-label">Build</span>
      <span class="card-meta-value card-lineage-digest" title="Build digest: {{ include.build_digest }}">
        <i class="ti ti-fingerprint" style="font-size: 0.75rem;" aria-hidden="true"></i>
        {{ include.build_digest | truncate: 12, "" }}
      </span>
    </div>
    {% elsif include.build_digest == "per-variant" %}
    <div class="card-meta-item">
      <span class="card-meta-label">Build</span>
      <span class="card-meta-value card-lineage-digest" title="Per-variant build digests available">
        <i class="ti ti-fingerprint" style="font-size: 0.75rem;" aria-hidden="true"></i>
        per-variant
      </span>
    </div>
    {% endif %}
  </div>
  {% endif %}

  {% if include.description %}
  <div class="card-description">{{ include.description | truncate: 120 }}</div>
  {% endif %}

  <!-- Variants Section (for multi-image containers) -->
  {% if include.has_variants %}
  <div class="variants-section">
    <div class="variants-header">
      <i class="ti ti-versions" aria-hidden="true"></i>
      <span>Available variants</span>
    </div>
    {% if include.versions %}
      <!-- Multi-version structure: group by version -->
      {% for version in include.versions %}
      <div class="version-group">
        <div class="version-label">{{ version.base_tag | default: version.tag }}</div>
        <div class="variant-tags">
          {% for variant in version.variants %}
            <span class="variant-tag{% if forloop.first and forloop.parentloop.first %} selected{% endif %}"
                  title="{{ variant.description }} — Click to select"
                  data-tag="{{ variant.tag }}"
                  data-size-amd64="{{ variant.size_amd64 | default: '' }}"
                  data-size-arm64="{{ variant.size_arm64 | default: '' }}"
                  role="button"
                  tabindex="0"
                  aria-pressed="{% if forloop.first and forloop.parentloop.first %}true{% else %}false{% endif %}"
                  aria-label="Select variant {{ variant.name }}{% if variant.is_default %} (default){% endif %}">
              :{{ variant.name }}
              {% if variant.is_default %}<span class="badge badge-primary" aria-hidden="true">default</span>{% endif %}
            </span>
          {% endfor %}
        </div>
      </div>
      {% endfor %}
    {% else %}
      <!-- Single-version structure -->
      <div class="variant-tags">
        {% for variant in include.variants %}
          <span class="variant-tag{% if forloop.first %} selected{% endif %}"
                title="{{ variant.description }} — Click to select"
                data-tag="{{ variant.tag }}"
                data-size-amd64="{{ variant.size_amd64 | default: '' }}"
                data-size-arm64="{{ variant.size_arm64 | default: '' }}"
                onclick="selectVariantTag(this)"
                onkeydown="if(event.key==='Enter'||event.key===' '){event.preventDefault();selectVariantTag(this);}"
                role="button"
                tabindex="0"
                aria-pressed="{% if forloop.first %}true{% else %}false{% endif %}"
                aria-label="Select variant {{ variant.tag }}{% if variant.is_default %} (default){% endif %}">
            :{{ variant.tag }}
            {% if variant.is_default %}<span class="badge badge-primary" aria-hidden="true">default</span>{% endif %}
          </span>
        {% endfor %}
      </div>
    {% endif %}
  </div>
  {% endif %}

  <!-- Docker Pull Command Section -->
  {% if include.ghcr_image and include.dockerhub_image %}
  <div class="pull-section"
       data-ghcr-base="ghcr.io/{{ include.github_username }}/{{ include.name }}"
       data-dockerhub-base="docker.io/{{ include.dockerhub_username }}/{{ include.name }}"
       data-default-tag="{% if include.has_variants %}{% if include.versions %}{{ include.versions[0].variants[0].tag }}{% else %}{{ include.variants[0].tag }}{% endif %}{% else %}{{ include.current_version }}{% endif %}">
    <div class="pull-header">
      <i class="ti ti-brand-docker" aria-hidden="true"></i>
      <span>Pull command</span>
    </div>
    <div class="pull-input-group">
      <input type="text"
             class="pull-input"
             id="pull-{{ include.name }}"
             value="docker pull {{ include.ghcr_image }}"
             readonly
             aria-label="Docker pull command for {{ include.name }}">
      <button class="copy-btn" type="button"
              aria-label="Copy pull command to clipboard">
        <i class="ti ti-copy" aria-hidden="true"></i>
      </button>
    </div>
  </div>
  {% endif %}

  <!-- Quick Links -->
  <nav class="card-links" aria-label="Container links">
    <a href="{{ '/container/' | append: include.name | append: '/' | relative_url }}"
       class="card-link" title="View Details">
      <i class="ti ti-info-circle" aria-hidden="true"></i> Details
    </a>
    <a href="https://github.com/{{ include.github_username }}/docker-containers/tree/master/{{ include.name }}"
       class="card-link" target="_blank" rel="noopener noreferrer" title="View Source (opens in new tab)">
      <i class="ti ti-folder" aria-hidden="true"></i> Source
    </a>
    <a href="https://ghcr.io/{{ include.github_username }}/{{ include.name }}"
       class="card-link" target="_blank" rel="noopener noreferrer" title="GHCR Package (opens in new tab)">
      <i class="ti ti-package" aria-hidden="true"></i> GHCR
    </a>
    <a href="https://hub.docker.com/r/{{ include.dockerhub_username }}/{{ include.name }}"
       class="card-link" target="_blank" rel="noopener noreferrer" title="Docker Hub (opens in new tab)">
      <i class="ti ti-brand-docker" aria-hidden="true"></i> Hub
    </a>
  </nav>
</article>
